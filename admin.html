<!-- templates/admin.html -->
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم - الحجوزات</title>
  <style>
    body { font-family: sans-serif; direction: rtl; background:#f3f4f6; padding:20px; }
    table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    th, td { border:1px solid #ddd; padding:10px; text-align:center; }
    th { background:#007BFF; color:#fff; }
    button { padding:6px 10px; border:none; border-radius:6px; cursor:pointer; }
    .edit { background:#ffc107; color:#000 }
    .save { background:#28a745; color:#fff }
    .delete { background:#dc3545; color:#fff; margin-right:6px; }
    .cancel { background:#6c757d; color:#fff; margin-right:6px; }
    input[type="text"]{padding:6px; width:100%;}
  </style>
</head>
<body>
  <h2>📋 لوحة التحكم في الحجوزات</h2>

  <table id="bookingTable">
    <tr>
      <th>الاسم</th>
      <th>الرقم</th>
      <th>التاريخ</th>
      <th>الوقت</th>
      <th>الوصف</th>
      <th>وقت الإرسال</th>
      <th>الإجراء</th>
    </tr>

    {% for b in bookings %}
    <tr data-index="{{ loop.index0 }}">
      <td>{{ b.name }}</td>
      <td>{{ b.number }}</td>
      <td>{{ b.date }}</td>
      <td>{{ b.time }}</td>
      <td>{{ b.desc }}</td>
      <td>{{ b.created }}</td>
      <td>
        <button class="edit">تعديل</button>
        <button class="delete">حذف</button>
      </td>
    </tr>
    {% endfor %}
  </table>

  <script>
    // تعديل
    document.querySelectorAll('.edit').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const row = e.target.closest('tr');
        const cells = row.querySelectorAll('td');
        const index = row.dataset.index;

        if (btn.textContent === 'تعديل') {
          for (let i=0; i<5; i++){
            const val = cells[i].textContent;
            cells[i].innerHTML = `<input type="text" value="${val}">`;
          }
          btn.textContent = 'موافق';
          btn.classList.remove('edit'); btn.classList.add('save');

          const cancelBtn = document.createElement('button');
          cancelBtn.textContent = 'إلغاء';
          cancelBtn.classList.add('cancel');
          btn.parentElement.appendChild(cancelBtn);
          cancelBtn.addEventListener('click', ()=> location.reload());

        } else {
          const updated = {
            name: cells[0].querySelector('input').value,
            number: cells[1].querySelector('input').value,
            date: cells[2].querySelector('input').value,
            time: cells[3].querySelector('input').value,
            desc: cells[4].querySelector('input').value
          };

          fetch(`/api/edit_booking/${index}`, {
            method: 'PUT',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(updated)
          }).then(res=>{
            if(res.ok){ alert('✅ تم التعديل'); location.reload(); }
            else { alert('❌ فشل التعديل'); }
          });
        }
      });
    });

    // حذف
    document.querySelectorAll('.delete').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const row = e.target.closest('tr');
        const index = row.dataset.index;
        if(confirm('هل تريد حذف هذا الحجز؟')){
          fetch(`/api/delete_booking/${index}`, { method:'DELETE' })
          .then(res=>{
            if(res.ok){ alert('🗑️ تم الحذف'); location.reload(); }
            else alert('❌ فشل الحذف');
          });
        }
      });
    });
    
  </script>
</body>
</html>
