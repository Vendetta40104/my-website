<!-- templates/admin.html -->
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</title>
  <style>
    body { font-family: sans-serif; direction: rtl; background:#f3f4f6; padding:20px; }
    table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    th, td { border:1px solid #ddd; padding:10px; text-align:center; }
    th { background:#007BFF; color:#fff; }
    button { padding:6px 10px; border:none; border-radius:6px; cursor:pointer; }
    .edit { background:#ffc107; color:#000 }
    .save { background:#28a745; color:#fff }
    .delete { background:#dc3545; color:#fff; margin-right:6px; }
    .cancel { background:#6c757d; color:#fff; margin-right:6px; }
    input[type="text"]{padding:6px; width:100%;}
  </style>
</head>
<body>
  <h2>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>

  <table id="bookingTable">
    <tr>
      <th>Ø§Ù„Ø§Ø³Ù…</th>
      <th>Ø§Ù„Ø±Ù‚Ù…</th>
      <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
      <th>Ø§Ù„ÙˆÙ‚Øª</th>
      <th>Ø§Ù„ÙˆØµÙ</th>
      <th>ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
    </tr>

    {% for b in bookings %}
    <tr data-index="{{ loop.index0 }}">
      <td>{{ b.name }}</td>
      <td>{{ b.number }}</td>
      <td>{{ b.date }}</td>
      <td>{{ b.time }}</td>
      <td>{{ b.desc }}</td>
      <td>{{ b.created }}</td>
      <td>
        <button class="edit">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="delete">Ø­Ø°Ù</button>
      </td>
    </tr>
    {% endfor %}
  </table>

  <script>
    // ØªØ¹Ø¯ÙŠÙ„
    document.querySelectorAll('.edit').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const row = e.target.closest('tr');
        const cells = row.querySelectorAll('td');
        const index = row.dataset.index;

        if (btn.textContent === 'ØªØ¹Ø¯ÙŠÙ„') {
          for (let i=0; i<5; i++){
            const val = cells[i].textContent;
            cells[i].innerHTML = `<input type="text" value="${val}">`;
          }
          btn.textContent = 'Ù…ÙˆØ§ÙÙ‚';
          btn.classList.remove('edit'); btn.classList.add('save');

          const cancelBtn = document.createElement('button');
          cancelBtn.textContent = 'Ø¥Ù„ØºØ§Ø¡';
          cancelBtn.classList.add('cancel');
          btn.parentElement.appendChild(cancelBtn);
          cancelBtn.addEventListener('click', ()=> location.reload());

        } else {
          const updated = {
            name: cells[0].querySelector('input').value,
            number: cells[1].querySelector('input').value,
            date: cells[2].querySelector('input').value,
            time: cells[3].querySelector('input').value,
            desc: cells[4].querySelector('input').value
          };

          fetch(`/api/edit_booking/${index}`, {
            method: 'PUT',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(updated)
          }).then(res=>{
            if(res.ok){ alert('âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„'); location.reload(); }
            else { alert('âŒ ÙØ´Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„'); }
          });
        }
      });
    });

    // Ø­Ø°Ù
    document.querySelectorAll('.delete').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const row = e.target.closest('tr');
        const index = row.dataset.index;
        if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ')){
          fetch(`/api/delete_booking/${index}`, { method:'DELETE' })
          .then(res=>{
            if(res.ok){ alert('ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù'); location.reload(); }
            else alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù');
          });
        }
      });
    });
    
  </script>
</body>
</html>
